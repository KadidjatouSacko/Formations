<!-- views/formations/lecteur.ejs -->
<%- include('../partials/head') %>

<body class="lecteur-page">
    <!-- Barre de progression de lecture -->
    <div class="reading-progress">
        <div class="reading-progress-bar" id="readingProgress"></div>
    </div>

    <div class="learning-layout">
        <!-- Sidebar du cours -->
        <aside class="course-sidebar">
            <div class="sidebar-header">
                <div class="course-info">
                    <h1 class="course-title"><%= formation.titre %></h1>
                    <p class="course-subtitle">Formation professionnelle</p>
                </div>
                
                <div class="overall-progress">
                    <div class="progress-header">
                        <span class="progress-label">Progression globale</span>
                        <span class="progress-percentage"><%= progression.pourcentage %>%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: <%= progression.pourcentage %>%"></div>
                    </div>
                </div>
            </div>

            <div class="module-list">
                <h3 class="section-title">Modules de formation</h3>
                
                <% for(let i = 1; i <= formation.totalModules; i++) { %>
                    <div class="module-item <%= i === module.numero ? 'active' : (i < module.numero ? 'completed' : 'locked') %>">
                        <div class="module-content">
                            <div class="module-header">
                                <div class="module-icon">
                                    <% if (i < module.numero) { %>‚úÖ<% } 
                                       else if (i === module.numero) { %>‚ñ∂Ô∏è<% } 
                                       else { %>üîí<% } %>
                                </div>
                                <div class="module-title">Module <%= i %></div>
                            </div>
                            <div class="module-meta">
                                <div class="module-duration">‚è±Ô∏è ~20 min</div>
                                <div class="module-status">
                                    <% if (i < module.numero) { %>Termin√©<% } 
                                       else if (i === module.numero) { %>En cours<% } 
                                       else { %>Verrouill√©<% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } %>
            </div>
        </aside>

        <!-- Contenu principal -->
        <main class="content-area">
            <header class="content-header">
                <div class="breadcrumb">
                    <a href="/dashboard">üè† Mon espace</a>
                    <span>‚Ä∫</span>
                    <a href="#"><%= formation.titre %></a>
                    <span>‚Ä∫</span>
                    <span class="breadcrumb-current"><%= module.titre %></span>
                </div>
                
                <div class="header-actions">
                    <button class="btn btn-secondary">üìã Notes</button>
                    <button class="btn btn-outline">üîñ Marquer</button>
                    <a href="/dashboard" class="btn btn-secondary">‚¨ÖÔ∏è Retour</a>
                </div>
            </header>

            <div class="main-content">
                <!-- En-t√™te du module -->
                <div class="module-header-main">
                    <div class="module-header-content">
                        <p class="module-number">Module <%= module.numero %> sur <%= formation.totalModules %></p>
                        <h1 class="module-title-main"><%= module.titre %></h1>
                        <p class="module-description"><%= module.description %></p>
                    </div>
                </div>

                <!-- Section vid√©o -->
                <section class="video-section">
                    <div class="video-container">
                        <video class="video-player" controls>
                            <source src="<%= module.contenu.video.url %>" type="video/mp4">
                            Votre navigateur ne supporte pas la lecture vid√©o.
                        </video>
                    </div>
                </section>

                <!-- Ressources t√©l√©chargeables -->
                <section class="content-section">
                    <h2 class="section-title-main">
                        <div class="section-icon">üìé</div>
                        Ressources t√©l√©chargeables
                    </h2>
                    
                    <div class="downloads-grid">
                        <% module.contenu.ressources.forEach(ressource => { %>
                            <div class="download-item" onclick="downloadResource('<%= ressource.nom %>')">
                                <div class="download-icon">üìÑ</div>
                                <div class="download-info">
                                    <div class="download-title"><%= ressource.nom %></div>
                                    <div class="download-meta"><%= ressource.type %> ‚Ä¢ <%= ressource.taille %></div>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                </section>

                <!-- Section Quiz -->
                <section class="content-section">
                    <h2 class="section-title-main">
                        <div class="section-icon">üìù</div>
                        √âvaluation du module
                    </h2>
                    
                    <div class="quiz-container">
                        <div class="quiz-icon">üéØ</div>
                        <h3 class="quiz-title">Quiz de validation</h3>
                        <p class="quiz-description">
                            Testez vos connaissances sur le module avec <%= module.contenu.quiz.questions %> questions.
                        </p>
                        
                        <div class="quiz-stats">
                            <div class="quiz-stat">
                                <span class="quiz-stat-value"><%= module.contenu.quiz.questions %></span>
                                <span class="quiz-stat-label">Questions</span>
                            </div>
                            <div class="quiz-stat">
                                <span class="quiz-stat-value"><%= module.contenu.quiz.duree %> min</span>
                                <span class="quiz-stat-label">Dur√©e</span>
                            </div>
                            <div class="quiz-stat">
                                <span class="quiz-stat-value"><%= module.contenu.quiz.scoreRequis %>%</span>
                                <span class="quiz-stat-label">Score requis</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="startQuizBtn">üöÄ Commencer le quiz</button>
                    </div>
                </section>
            </div>

            <!-- Navigation entre modules -->
            <footer class="module-navigation">
                <div class="nav-container">
                    <% if (module.numero > 1) { %>
                        <a href="/formations/<%= formation.id %>/module/<%= module.numero - 1 %>" class="nav-item nav-prev">
                            <div class="nav-icon">‚¨ÖÔ∏è</div>
                            <div class="nav-content">
                                <div class="nav-label">Pr√©c√©dent</div>
                                <div class="nav-title">Module <%= module.numero - 1 %></div>
                            </div>
                        </a>
                    <% } %>
                    
                    <div class="nav-center">
                        <button class="btn btn-outline">üìã R√©sum√©</button>
                        <button class="btn btn-secondary">‚≠ê Favoris</button>
                    </div>
                    
                    <% if (module.numero < formation.totalModules) { %>
                        <a href="/formations/<%= formation.id %>/module/<%= module.numero + 1 %>" class="nav-item nav-next">
                            <div class="nav-content">
                                <div class="nav-label">Suivant</div>
                                <div class="nav-title">Module <%= module.numero + 1 %></div>
                            </div>
                            <div class="nav-icon">‚û°Ô∏è</div>
                        </a>
                    <% } %>
                </div>
            </footer>
        </main>
    </div>

    <!-- Scripts -->
    <script src="/js/lecteur.js"></script>
</body>
</html>