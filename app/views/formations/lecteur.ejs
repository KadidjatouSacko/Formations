<%- include('../layout/main', { body: `
    <div class="learning-layout">
        <!-- Course Sidebar -->
        <aside class="course-sidebar" id="courseSidebar">
            <div class="sidebar-header">
                <div class="course-info">
                    <h1 class="course-title">${course.title}</h1>
                    <p class="course-subtitle">${course.description}</p>
                </div>
                
                <div class="overall-progress">
                    <div class="progress-header">
                        <span class="progress-label">Progression globale</span>
                        <span class="progress-percentage">${userProgress.totalProgress}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${userProgress.totalProgress}%"></div>
                    </div>
                    <div class="progress-stats">
                        <div class="stat-item">
                            <span class="stat-value">${userProgress.completedModules.length}/${course.totalModules}</span>
                            <span class="stat-label">Modules</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${userProgress.timeSpent}</span>
                            <span class="stat-label">Temps</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">94%</span>
                            <span class="stat-label">Score</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-list">
                <div class="module-section">
                    <h3 class="section-title">Modules de formation</h3>
                    
                    <% course.modules.forEach((module, index) => { %>
                        <div class="module-item ${module.status}" data-module-id="${module.id}">
                            <div class="module-content">
                                <div class="module-header">
                                    <div class="module-icon">
                                        <%= module.status === 'completed' ? '‚úÖ' : 
                                            module.status === 'active' ? '‚ñ∂Ô∏è' : 
                                            module.status === 'locked' ? 'üîí' : 'üìñ' %>
                                    </div>
                                    <div class="module-title">${module.title}</div>
                                </div>
                                <div class="module-meta">
                                    <div class="module-duration">
                                        <span>‚è±Ô∏è</span>
                                        <span>${module.duration}</span>
                                    </div>
                                    <div class="module-status ${module.status}">
                                        <%= module.status === 'completed' ? 'Termin√©' :
                                            module.status === 'active' ? 'En cours' :
                                            module.status === 'locked' ? 'Verrouill√©' : 'Disponible' %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </aside>

        <!-- Zone de contenu principal -->
        <main class="content-area">
            <div id="module-content">
                <!-- Le contenu sera charg√© dynamiquement -->
            </div>
        </main>
    </div>

    <script>
        // Chargement dynamique des modules
        document.querySelectorAll('.module-item').forEach(item => {
            item.addEventListener('click', async () => {
                if (item.classList.contains('locked')) {
                    showToast('üîí Module verrouill√©. Terminez d\'abord le module actuel.');
                    return;
                }
                
                const moduleId = item.dataset.moduleId;
                const courseId = '${course.id}';
                
                try {
                    const response = await fetch(\`/formation/lecteur/\${courseId}/module/\${moduleId}\`);
                    const html = await response.text();
                    
                    document.getElementById('module-content').innerHTML = html;
                    
                    // Mise √† jour de l'√©tat actif
                    document.querySelectorAll('.module-item').forEach(m => m.classList.remove('active'));
                    item.classList.add('active');
                    
                } catch (error) {
                    console.error('Erreur chargement module:', error);
                    showToast('‚ùå Erreur lors du chargement du module');
                }
            });
        });

        // Auto-chargement du module actuel
        window.addEventListener('load', () => {
            const currentModule = document.querySelector('.module-item.active');
            if (currentModule) {
                currentModule.click();
            }
        });
    </script>
` }) %>